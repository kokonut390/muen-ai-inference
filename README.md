# Muen AI Inference Service

é€™æ˜¯ä¸€å€‹åŸºæ–¼ **PyTorch** èˆ‡ **FastAPI** çš„æ‰‹å¯«æ•¸å­—è¾¨è­˜æ¨è«–æœå‹™ã€‚
æœ¬å°ˆæ¡ˆæ¡ç”¨ Docker å®¹å™¨åŒ–æŠ€è¡“é€²è¡Œéƒ¨ç½²ï¼Œä¸¦æä¾› RESTful API èˆ‡è‡ªå‹•åŒ–æ‰¹æ¬¡æ¨è«–è…³æœ¬ï¼Œå®Œæ•´å±•ç¤ºå¾æ¨¡å‹éƒ¨ç½²åˆ°æ‰¹æ¬¡è³‡æ–™è™•ç†çš„æµç¨‹ã€‚

## â­ åŠ åˆ†é …ç›® (Bonus Features)
æœ¬å°ˆæ¡ˆå·²å®Œæˆä»¥ä¸‹é€²éšè¦æ±‚ï¼š
1.  âœ… **Batch Inference API**: æ–°å¢ `/predict_batch` æ¥å£ï¼Œæ”¯æ´åŒæ™‚ä¸Šå‚³å¤šå¼µåœ–ç‰‡é€²è¡Œæ‰¹æ¬¡æ¨è«–ã€‚
2.  âœ… **Docker Compose**: ä½¿ç”¨ `docker-compose.yml` å®šç¾©æœå‹™ï¼Œç°¡åŒ–éƒ¨ç½²æµç¨‹ã€‚

---

## ğŸ“‚ å°ˆæ¡ˆçµæ§‹ (Project Structure)

```text
.
â”œâ”€â”€ README.md             # å°ˆæ¡ˆèªªæ˜æ–‡ä»¶
â”œâ”€â”€ .gitignore            # Git å¿½ç•¥è¨­å®š
â””â”€â”€ muen-ai-service/      # æ ¸å¿ƒç¨‹å¼ç¢¼ç›®éŒ„
    â”œâ”€â”€ docker-compose.yml# Docker Compose æœå‹™å®šç¾©æª” (Bonus)
    â”œâ”€â”€ main.py           # FastAPI æœå‹™ä¸»ç¨‹å¼ (å« /predict_batch)
    â”œâ”€â”€ batch_predict.py  # æ‰¹æ¬¡é æ¸¬è…³æœ¬ (ETL æµç¨‹ï¼šCSV -> Images -> Inference -> CSV)
    â”œâ”€â”€ Dockerfile        # å®¹å™¨åŒ–å»ºç½®è¨­å®š (åŸºæ–¼ python:3.9-slim)
    â”œâ”€â”€ requirements.txt  # Python ç›¸ä¾å¥—ä»¶æ¸…å–®
    â””â”€â”€ model_weights.pth # é å…ˆè¨“ç·´å¥½çš„æ¨¡å‹æ¬Šé‡
```

## âš ï¸ ç‰¹åˆ¥èªªæ˜ (Important Notes)

ç‚ºäº†ç¬¦åˆè€ƒé¡Œè¦æ±‚ä¸¦é©æ‡‰åŸå§‹è³‡æ–™æ ¼å¼ï¼Œæœ¬å°ˆæ¡ˆåŒ…å«ä»¥ä¸‹ç‰¹åˆ¥è¨­è¨ˆï¼š

1.  **è³‡æ–™ä¾†æºå‰è™•ç† (Data Preprocessing)**ï¼š
    ç”±æ–¼åŸå§‹è³‡æ–™åƒ…æä¾› `test.csv` (åƒç´ æ•¸æ“š)ï¼Œä½†é¡Œç›®è¦æ±‚ã€Œå°è³‡æ–™å¤¾ä¸­åœ–ç‰‡é€²è¡Œæ¨è«–ã€ã€‚
    å› æ­¤ï¼Œæœ¬å°ˆæ¡ˆçš„ `batch_predict.py` è…³æœ¬å…§å»º ETL æµç¨‹ï¼Œæœƒè‡ªå‹•è®€å– CSV ä¸¦å°‡å…¶è½‰æ›ç‚º `test_images/` è³‡æ–™å¤¾ä¸­çš„å¯¦é«”åœ–ç‰‡ï¼Œå†é€²è¡Œ API æ¨è«–ï¼Œå®Œç¾é”æˆé¡Œç›®é‚è¼¯è¦æ±‚ã€‚

2.  **API æ¸¬è©¦å·¥å…· (Testing Tool)**ï¼š
    æœ¬æœå‹™æ•´åˆäº† **Swagger UI (OpenAPI)** è‡ªå‹•åŒ–æ–‡ä»¶ç³»çµ±ã€‚
    å•Ÿå‹•æœå‹™å¾Œï¼Œå¯ç›´æ¥é€éç€è¦½å™¨é€²è¡Œäº’å‹•å¼ API æ¸¬è©¦ (ä¸Šå‚³åœ–ç‰‡ã€æª¢è¦– JSON å›æ‡‰)ï¼Œå…¶åŠŸèƒ½èˆ‡æ•ˆåŠ›ç­‰åŒæ–¼ Postmanã€‚

---

## ğŸš€ å¿«é€Ÿé–‹å§‹ (Quick Start)

### æ­¥é©Ÿ 0ï¼šæº–å‚™è³‡æ–™ (Data Setup)
æœ¬å°ˆæ¡ˆä¸åŒ…å«åŸå§‹æ•¸æ“šã€‚åœ¨é–‹å§‹ä¹‹å‰ï¼Œè«‹ç¢ºä¿å°‡ `test.csv` æª”æ¡ˆæ”¾ç½®æ–¼å°ˆæ¡ˆæ ¹ç›®éŒ„ (`muen-ai-service/` è³‡æ–™å¤¾å…§)ã€‚
> âš ï¸ æ³¨æ„ï¼šè‹¥ç„¡æ­¤æª”æ¡ˆï¼Œæ‰¹æ¬¡é æ¸¬è…³æœ¬å°‡ç„¡æ³•ç”Ÿæˆåœ–ç‰‡é€²è¡Œæ¨è«–ã€‚

### æ­¥é©Ÿ 1ï¼šé€²å…¥å°ˆæ¡ˆç›®éŒ„
è«‹é–‹å•Ÿçµ‚ç«¯æ©Ÿï¼Œä¸¦åˆ‡æ›è‡³ç¨‹å¼ç¢¼æ‰€åœ¨çš„è³‡æ–™å¤¾ï¼š

```bash
cd muen-ai-service
```

### æ­¥é©Ÿ 2ï¼šä½¿ç”¨ Docker Compose å•Ÿå‹• (æ¨è–¦)
é€™æ˜¯æœ€ç°¡å–®çš„å•Ÿå‹•æ–¹å¼ï¼Œæœƒè‡ªå‹•å®Œæˆå»ºç½®èˆ‡åŸ·è¡Œï¼š
```bash
docker-compose up --build
```
> ç•¶çœ‹åˆ° `Application startup complete` å³ä»£è¡¨å•Ÿå‹•æˆåŠŸã€‚

*(è‹¥ä¸ä½¿ç”¨ Docker Composeï¼Œä»å¯ä½¿ç”¨å‚³çµ± `docker build` èˆ‡ `docker run` æŒ‡ä»¤)*

### æ­¥é©Ÿ 3ï¼šAPI åŠŸèƒ½æ¸¬è©¦
è«‹æ‰“é–‹ç€è¦½å™¨è¨ªå•ï¼š http://localhost:5000/docs ï¼Œä¸¦ä¾ç…§ä»¥ä¸‹è¦ç¯„é€²è¡Œæ¸¬è©¦ã€‚

#### 1. å–®å¼µæ¨è«– `/predict`
- **Method**: `POST`
- **åŠŸèƒ½**: ä¸Šå‚³ä¸€å¼µåœ–ç‰‡ï¼Œå›å‚³å–®ä¸€æ•¸å­—é æ¸¬çµæœã€‚
- **ç¯„ä¾‹å›å‚³**:
```json
{
  "filename": "img_0.png",
  "prediction": 6
}
```

#### 2. æ‰¹æ¬¡æ¨è«– `/predict_batch` (Bonus)
- **Method**: `POST`
- **åŠŸèƒ½**: æ”¯æ´åŒæ™‚é¸å–å¤šå¼µåœ–ç‰‡ä¸Šå‚³ï¼Œå›å‚³é æ¸¬åˆ—è¡¨ã€‚
- **ç¯„ä¾‹å›å‚³**:
```json
{
  "results": [
    {"filename": "1.png", "prediction": 2, "status": "success"},
    {"filename": "2.png", "prediction": 7, "status": "success"}
  ]
}
```

---

## ğŸ“¦ æ‰¹æ¬¡é æ¸¬ (Batch Prediction)

æœ¬å°ˆæ¡ˆæä¾›è‡ªå‹•åŒ–è…³æœ¬ï¼Œå¯ä¸€æ¬¡æ€§å®Œæˆã€Œåœ–ç‰‡ç”Ÿæˆã€ã€ã€ŒAPI æ¨è«–ã€èˆ‡ã€ŒçµæœåŒ¯å‡ºã€ã€‚

è«‹ä¿æŒ Docker æœå‹™é‹ä½œä¸­ï¼Œä¸¦é–‹å•Ÿ**å¦ä¸€å€‹çµ‚ç«¯æ©Ÿè¦–çª—**åŸ·è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼š

#### 1. æŸ¥è©¢å®¹å™¨ ID
è‹¥ä½¿ç”¨ Docker Composeï¼Œå®¹å™¨åç¨±é€šå¸¸ç‚º `muen-api-container`ã€‚è‹¥ä½¿ç”¨ä¸€èˆ¬æŒ‡ä»¤ï¼Œè«‹è¼¸å…¥ä»¥ä¸‹æŒ‡ä»¤æŸ¥è©¢ï¼š
```bash
docker ps
# è¤‡è£½ CONTAINER ID (ä¾‹å¦‚: a1b2c3d4e5f6)
```

#### 2. åŸ·è¡Œé æ¸¬è…³æœ¬
æ­¤æŒ‡ä»¤æœƒè‡ªå‹•è™•ç†åœ–ç‰‡ä¸¦å‘¼å« APIï¼Œè¼¸å‡ºé€²åº¦æ¢ï¼š
```bash
# è‹¥ä½¿ç”¨ Docker Compose (æ¨è–¦)
docker exec muen-api-container python -u batch_predict.py

# è‹¥ä½¿ç”¨ä¸€èˆ¬å®¹å™¨ ID
docker exec <Container_ID> python -u batch_predict.py
```

#### 3. å–å‡ºçµæœ CSV
é æ¸¬å®Œæˆå¾Œï¼Œå°‡çµæœæª”æ¡ˆä¸‹è¼‰å›æœ¬æ©Ÿï¼š
```bash
# è‹¥ä½¿ç”¨ Docker Compose
docker cp muen-api-container:/app/result.csv .

# è‹¥ä½¿ç”¨ä¸€èˆ¬å®¹å™¨ ID
docker cp <Container_ID>:/app/result.csv .
```

ç¾åœ¨ï¼Œæ‚¨å¯ä»¥åœ¨å°ˆæ¡ˆç›®éŒ„ä¸‹æ‰¾åˆ° `result.csv` æª”æ¡ˆã€‚